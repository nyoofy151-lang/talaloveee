<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ø¯Ø±Ø¯Ø´Ø© Ù…ØªØ¹Ø¯Ø¯Ø© Ø§Ù„ØºØ±Ù ğŸ’–</title>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<style>
body { margin:0; padding:0; font-family:"Cairo",sans-serif; background:#ffe6f2; overflow-x:hidden; }
h1 { text-align:center; margin-top:20px; font-size:45px; color:#d6006e; text-shadow:0 0 15px #ff4fa7; }
#loveText { width:85%; max-width:700px; margin:20px auto; background:white; border-radius:15px; padding:20px; font-size:22px; line-height:1.8; color:#7a0058; box-shadow:0 0 20px rgba(255,0,128,0.25); min-height:100px; white-space:pre-line; }
#chatBox { width:85%; max-width:600px; height:300px; background:white; margin:20px auto; border-radius:15px; padding:15px; overflow-y:auto; box-shadow:0 0 15px rgba(255,0,128,0.3); }
.message { display:flex; justify-content:space-between; align-items:center; background:#ffe0f1; padding:10px; border-radius:10px; margin:5px 0; flex-wrap:wrap; }
.msg-text { flex:1; margin-right:10px; word-break:break-word; }
.msg-user { font-weight:bold; margin-left:5px; color:#d6006e; }
.msg-time { font-size:12px; color:#7a0058; margin-left:auto; }
.deleteBtn, .editBtn, .saveBtn { background:transparent; border:none; cursor:pointer; font-size:18px; margin-left:5px; }
.deleteBtn { color:#d6006e; }
.editBtn { color:#1a73e8; }
.saveBtn { color:#00a600; }
#messageInput { width:60%; padding:10px; border:2px solid #ff4fa7; border-radius:10px; font-size:18px; }
#sendBtn { padding:10px 20px; background:#ff4fa7; border:none; border-radius:10px; color:white; font-size:18px; cursor:pointer; margin-left:10px; }
.heart { position:fixed; bottom:-10px; color:#ff1f8f; font-size:20px; animation:floatUp 4s linear infinite; opacity:0.8; z-index:9999; }
@keyframes floatUp { 0%{transform:translateY(0) scale(1); opacity:1;} 100%{transform:translateY(-120vh) scale(1.5); opacity:0;} }
#loginOverlay, #roomOverlay { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(255,230,242,0.95); display:flex; flex-direction:column; justify-content:center; align-items:center; z-index:10000; }
#loginOverlay input, #roomOverlay input { padding:10px; font-size:18px; border-radius:10px; border:2px solid #ff4fa7; margin-bottom:10px; }
#loginOverlay button, #roomOverlay button { padding:10px 20px; background:#ff4fa7; border:none; border-radius:10px; color:white; font-size:18px; cursor:pointer; }
</style>
</head>
<body>

<h1>ğŸ’– Ø¯Ø±Ø¯Ø´Ø© Ù…ØªØ¹Ø¯Ø¯Ø© Ø§Ù„ØºØ±Ù ğŸ’–</h1>
<div id="loveText">Ø£Ù‡Ù„Ù‹Ø§ Ø¨Ùƒ ğŸ’Œ Ø§Ø®ØªØ± ØºØ±ÙØªÙƒ ÙˆØ§Ø¨Ø¯Ø£ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©!</div>
<div id="chatBox"></div>

<div style="text-align:center; margin-bottom:30px;">
    <input id="messageInput" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ...">
    <button id="sendBtn">Ø¥Ø±Ø³Ø§Ù„ â¤ï¸</button>
</div>

<div id="loginOverlay">
    <input type="text" id="usernameInput" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ Ù‡Ù†Ø§">
    <button id="loginBtn">Ø¯Ø®ÙˆÙ„</button>
</div>

<div id="roomOverlay">
    <input type="text" id="roomInput" placeholder="Ø§Ø³Ù… Ø§Ù„ØºØ±ÙØ©">
    <button id="enterRoomBtn">Ø¯Ø®ÙˆÙ„ Ø§Ù„ØºØ±ÙØ©</button>
</div>

<script>
const firebaseConfig = {
    apiKey: "Ø¶Ø¹ Ù‡Ù†Ø§ API_KEY",
    authDomain: "Ø¶Ø¹ Ù‡Ù†Ø§ AUTH_DOMAIN",
    databaseURL: "Ø¶Ø¹ Ù‡Ù†Ø§ DATABASE_URL",
    projectId: "Ø¶Ø¹ Ù‡Ù†Ø§ PROJECT_ID",
    storageBucket: "Ø¶Ø¹ Ù‡Ù†Ø§ STORAGE_BUCKET",
    messagingSenderId: "Ø¶Ø¹ Ù‡Ù†Ø§ MESSAGING_SENDER_ID",
    appId: "Ø¶Ø¹ Ù‡Ù†Ø§ APP_ID"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let username="", room="";
const loginOverlay = document.getElementById("loginOverlay");
const usernameInput = document.getElementById("usernameInput");
const loginBtn = document.getElementById("loginBtn");
const roomOverlay = document.getElementById("roomOverlay");
const roomInput = document.getElementById("roomInput");
const enterRoomBtn = document.getElementById("enterRoomBtn");
const chatBox = document.getElementById("chatBox");
const input = document.getElementById("messageInput");
const sendBtn = document.getElementById("sendBtn");

loginBtn.onclick = ()=> {
    const name = usernameInput.value.trim();
    if(!name) return alert("Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ!");
    username=name; loginOverlay.style.display="none"; roomOverlay.style.display="flex";
};
usernameInput.addEventListener("keydown", e=>{ if(e.key==="Enter") loginBtn.onclick(); });

enterRoomBtn.onclick = ()=>{
    const r = roomInput.value.trim();
    if(!r) return alert("Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„ØºØ±ÙØ©!");
    room=r; roomOverlay.style.display="none"; loadMessages();
};
roomInput.addEventListener("keydown", e=>{ if(e.key==="Enter") enterRoomBtn.onclick(); });

function addMessage(text,user,time,id){
    const msgDiv = document.createElement("div"); msgDiv.classList.add("message");
    const userSpan = document.createElement("span"); userSpan.classList.add("msg-user"); userSpan.textContent=user;
    const textSpan = document.createElement("span"); textSpan.classList.add("msg-text"); textSpan.textContent=text;
    const timeSpan = document.createElement("span"); timeSpan.classList.add("msg-time"); timeSpan.textContent=time;
    const editBtn = document.createElement("button"); editBtn.classList.add("editBtn"); editBtn.textContent="âœï¸";
    editBtn.onclick = ()=>{
        if(user!==username) return alert("Ù„Ø§ ØªØ³ØªØ·ÙŠØ¹ ØªØ¹Ø¯ÙŠÙ„ Ø±Ø³Ø§Ù„Ø© Ø´Ø®Øµ Ø¢Ø®Ø±!");
        const inputField = document.createElement("input"); inputField.type="text"; inputField.value=text; inputField.style.flex="1";
        textSpan.replaceWith(inputField);
        const saveBtn=document.createElement("button"); saveBtn.classList.add("saveBtn"); saveBtn.textContent="ğŸ’¾";
        inputField.parentNode.insertBefore(saveBtn,inputField.nextSibling);
        saveBtn.onclick=()=>{ const newText=inputField.value; inputField.replaceWith(textSpan); saveBtn.remove(); textSpan.textContent=newText; db.ref('rooms/'+room+'/'+id).update({text:newText}); };
    };
    const delBtn=document.createElement("button"); delBtn.classList.add("deleteBtn"); delBtn.textContent="ğŸ—‘ï¸";
    delBtn.onclick = ()=>{ if(user!==username)return alert("Ù„Ø§ ØªØ³ØªØ·ÙŠØ¹ Ø­Ø°Ù Ø±Ø³Ø§Ù„Ø© Ø´Ø®Øµ Ø¢Ø®Ø±!"); db.ref('rooms/'+room+'/'+id).remove(); };

    msgDiv.appendChild(userSpan); msgDiv.appendChild(textSpan); msgDiv.appendChild(timeSpan); msgDiv.appendChild(editBtn); msgDiv.appendChild(delBtn);
    chatBox.appendChild(msgDiv); chatBox.scrollTop = chatBox.scrollHeight;
}

function sendMessage(){
    if(!username || !room || input.value.trim()==="") return;
    const msg=input.value;
    const time=new Date().toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'});
    const newMsgRef=db.ref('rooms/'+room).push();
    newMsgRef.set({user:username,text:msg,time:time}); input.value="";
}
sendBtn.onclick=sendMessage;
input.addEventListener("keydown", e=>{ if(e.key==="Enter") sendMessage(); });

function loadMessages(){
    const ref=db.ref('rooms/'+room); chatBox.innerHTML="";
    ref.on('child_added', snap=>{ const m=snap.val(); addMessage(m.text,m.user,m.time,snap.key); });
    ref.on('child_changed', snap=>{ chatBox.innerHTML=""; ref.once('value',s=>{ s.forEach(c=>{ const m=c.val(); addMessage(m.text,m.user,m.time,c.key); }); }); });
    ref.on('child_removed', snap=>{ chatBox.innerHTML=""; ref.once('value',s=>{ s.forEach(c=>{ const m=c.val(); addMessage(m.text,m.user,m.time,c.key); }); }); });
}

// ØªØ£Ø«ÙŠØ± Ø§Ù„Ù‚Ù„ÙˆØ¨
function createHeart(){ const heart=document.createElement("div"); heart.classList.add("heart"); heart.textContent="ğŸ’—"; heart.style.left=Math.random()*window.innerWidth+"px"; heart.style.fontSize=(20+Math.random()*30)+"px"; heart.style.animationDuration=(3+Math.random()*3)+"s"; document.body.appendChild(heart); setTimeout(()=>heart.remove(),6000);}
setInterval(createHeart,250);
</script>

</body>
</html>
